<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Advent of Code 2023 with Modern Fortran">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>lu1fad &ndash; AoC-2023</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">AoC-2023 </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>lu1fad
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip"
                 data-bs-placement="bottom" data-html="true"
                 title=" 4.6% of total for procedures.">465 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/lusol.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/lusol.f90.html'>lusol.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/lusol.html'>lusol</a></li>
            <li class="breadcrumb-item active" aria-current="page">lu1fad</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/lu1fad.html#src">lu1fad</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine lu1fad(m, n, nelem, lena, luparm, parmlu, a, indc, indr, p, q, lenc, lenr, locc, locr, iploc, iqloc, ipinv, iqinv, w, lenH, Ha, Hj, Hk, Amaxr, inform, lenL, lenU, minlen, mersum, nUtri, nLtri, ndens1, ndens2, nrank, nslack, Lmax, Umax, DUmax, DUmin, Akmax)  
</h2>
    

    <p>!   a(ldiagU + nrowu) = abest ! This was in pivot order.
!!! DEBUG</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-m~33"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>m</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~48"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>n</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nelem~2"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nelem</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lena~2"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lena</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-luparm~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>luparm</strong>(30)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-parmlu~2"></span>
              real(kind=rp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>parmlu</strong>(30)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~8"></span>
              real(kind=rp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>a</strong>(lena)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-indc~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>indc</strong>(lena)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-indr~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>indr</strong>(lena)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~8"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lenc~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lenc</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lenr~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lenr</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-locc~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>locc</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-locr~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>locr</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iploc~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iploc</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iqloc~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iqloc</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ipinv~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ipinv</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iqinv~2"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iqinv</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w~9"></span>
              real(kind=rp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>w</strong>(n)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lenh"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lenH</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ha"></span>
              real(kind=rp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ha</strong>(lenH)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-hj"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Hj</strong>(lenH)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-hk"></span>
              integer(kind=ip),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Hk</strong>(lenH)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-amaxr"></span>
              real(kind=rp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Amaxr</strong>(m)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-inform~4"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>inform</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lenl"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lenL</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lenu"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>lenU</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-minlen"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>minlen</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mersum"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>mersum</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nutri"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nUtri</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nltri"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nLtri</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ndens1"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ndens1</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ndens2"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ndens2</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nrank"></span>
              integer(kind=ip),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nrank</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nslack"></span>
              integer(kind=ip),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nslack</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lmax"></span>
              real(kind=rp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lmax</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-umax"></span>
              real(kind=rp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Umax</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-dumax"></span>
              real(kind=rp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>DUmax</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-dumin"></span>
              real(kind=rp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>DUmin</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-akmax"></span>
              real(kind=rp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Akmax</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lu1fad~~CallsGraph Pages: 1 -->
<svg id="proclu1fadCallsGraph" width="460pt" height="574pt"
 viewBox="0.00 0.00 460.00 574.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lu1fad~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 570)">
<title>proc~~lu1fad~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-570 456,-570 456,4 -4,4"/>
<!-- proc~lu1fad -->
<g id="proc~~lu1fad~~CallsGraph_node1" class="node">
<title>proc~lu1fad</title>
<polygon fill="none" stroke="black" points="79,-297 0,-297 0,-273 79,-273 79,-297"/>
<text text-anchor="middle" x="39.5" y="-282.6" font-family="Helvetica,sans-Serif" font-size="10.50">lusol::lu1fad</text>
</g>
<!-- proc~hbuild -->
<g id="proc~~lu1fad~~CallsGraph_node2" class="node">
<title>proc~hbuild</title>
<g id="a_proc~~lu1fad~~CallsGraph_node2"><a xlink:href=".././proc/hbuild.html" xlink:title="lusol::Hbuild">
<polygon fill="#d9534f" stroke="#d9534f" points="198,-566 119,-566 119,-542 198,-542 198,-566"/>
<text text-anchor="middle" x="158.5" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hbuild</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~hbuild -->
<g id="proc~~lu1fad~~CallsGraph_edge1" class="edge">
<title>proc~lu1fad&#45;&gt;proc~hbuild</title>
<path fill="none" stroke="#000000" d="M41.24,-297.25C44.14,-335.38 57.54,-453.9 115,-528 117.19,-530.82 119.77,-533.41 122.57,-535.76"/>
<polygon fill="#000000" stroke="#000000" points="120.72,-538.74 130.87,-541.78 124.83,-533.08 120.72,-538.74"/>
</g>
<!-- proc~hchange -->
<g id="proc~~lu1fad~~CallsGraph_node3" class="node">
<title>proc~hchange</title>
<g id="a_proc~~lu1fad~~CallsGraph_node3"><a xlink:href=".././proc/hchange.html" xlink:title="lusol::Hchange">
<polygon fill="#d9534f" stroke="#d9534f" points="331,-524 238,-524 238,-500 331,-500 331,-524"/>
<text text-anchor="middle" x="284.5" y="-509.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hchange</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~hchange -->
<g id="proc~~lu1fad~~CallsGraph_edge2" class="edge">
<title>proc~lu1fad&#45;&gt;proc~hchange</title>
<path fill="none" stroke="#000000" d="M40.64,-297.25C41.77,-334.11 50.63,-444.5 115,-495 146.37,-519.61 191.79,-522.92 227.57,-520.59"/>
<polygon fill="#000000" stroke="#000000" points="228.18,-524.05 237.86,-519.74 227.61,-517.07 228.18,-524.05"/>
</g>
<!-- proc~hdelete -->
<g id="proc~~lu1fad~~CallsGraph_node4" class="node">
<title>proc~hdelete</title>
<g id="a_proc~~lu1fad~~CallsGraph_node4"><a xlink:href=".././proc/hdelete.html" xlink:title="lusol::Hdelete">
<polygon fill="#d9534f" stroke="#d9534f" points="202,-486 115,-486 115,-462 202,-462 202,-486"/>
<text text-anchor="middle" x="158.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hdelete</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~hdelete -->
<g id="proc~~lu1fad~~CallsGraph_edge3" class="edge">
<title>proc~lu1fad&#45;&gt;proc~hdelete</title>
<path fill="none" stroke="#000000" d="M42.9,-297.17C49.39,-327.24 69.94,-406.03 115,-453 116.03,-454.08 117.13,-455.11 118.28,-456.09"/>
<polygon fill="#000000" stroke="#000000" points="116.31,-458.98 126.49,-461.93 120.37,-453.28 116.31,-458.98"/>
</g>
<!-- proc~lu1ful -->
<g id="proc~~lu1fad~~CallsGraph_node5" class="node">
<title>proc~lu1ful</title>
<g id="a_proc~~lu1fad~~CallsGraph_node5"><a xlink:href=".././proc/lu1ful.html" xlink:title="lusol::lu1ful">
<polygon fill="#d9534f" stroke="#d9534f" points="196,-444 121,-444 121,-420 196,-420 196,-444"/>
<text text-anchor="middle" x="158.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1ful</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1ful -->
<g id="proc~~lu1fad~~CallsGraph_edge4" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1ful</title>
<path fill="none" stroke="#000000" d="M44.99,-297.31C54.46,-321.83 78.67,-377.3 115,-411 116.13,-412.05 117.32,-413.06 118.57,-414.03"/>
<polygon fill="#000000" stroke="#000000" points="117.01,-417.2 127.28,-419.83 120.89,-411.37 117.01,-417.2"/>
</g>
<!-- proc~lu1gau -->
<g id="proc~~lu1fad~~CallsGraph_node6" class="node">
<title>proc~lu1gau</title>
<g id="a_proc~~lu1fad~~CallsGraph_node6"><a xlink:href=".././proc/lu1gau.html" xlink:title="lusol::lu1gau">
<polygon fill="#d9534f" stroke="#d9534f" points="199.5,-402 117.5,-402 117.5,-378 199.5,-378 199.5,-402"/>
<text text-anchor="middle" x="158.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1gau</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1gau -->
<g id="proc~~lu1fad~~CallsGraph_edge5" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1gau</title>
<path fill="none" stroke="#000000" d="M48.93,-297.18C61.61,-314.83 87.11,-347.71 115,-369 116.75,-370.34 118.61,-371.63 120.52,-372.86"/>
<polygon fill="#000000" stroke="#000000" points="118.75,-375.89 129.15,-377.92 122.29,-369.84 118.75,-375.89"/>
</g>
<!-- proc~lu1mar -->
<g id="proc~~lu1fad~~CallsGraph_node7" class="node">
<title>proc~lu1mar</title>
<g id="a_proc~~lu1fad~~CallsGraph_node7"><a xlink:href=".././proc/lu1mar.html" xlink:title="lusol::lu1mar">
<polygon fill="#d9534f" stroke="#d9534f" points="200,-360 117,-360 117,-336 200,-336 200,-360"/>
<text text-anchor="middle" x="158.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1mar</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1mar -->
<g id="proc~~lu1fad~~CallsGraph_edge6" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1mar</title>
<path fill="none" stroke="#000000" d="M61.21,-297.07C76.06,-305.64 96.62,-317.29 115,-327 117.68,-328.42 120.47,-329.86 123.27,-331.29"/>
<polygon fill="#000000" stroke="#000000" points="121.71,-334.42 132.22,-335.79 124.85,-328.17 121.71,-334.42"/>
</g>
<!-- proc~lu1mrp -->
<g id="proc~~lu1fad~~CallsGraph_node8" class="node">
<title>proc~lu1mrp</title>
<g id="a_proc~~lu1fad~~CallsGraph_node8"><a xlink:href=".././proc/lu1mrp.html" xlink:title="lusol::lu1mRP">
<polygon fill="#d9534f" stroke="#d9534f" points="201,-318 116,-318 116,-294 201,-294 201,-318"/>
<text text-anchor="middle" x="158.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1mRP</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1mrp -->
<g id="proc~~lu1fad~~CallsGraph_edge7" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1mrp</title>
<path fill="none" stroke="#000000" d="M79.13,-291.93C87.65,-293.46 96.79,-295.1 105.73,-296.71"/>
<polygon fill="#000000" stroke="#000000" points="105.22,-300.17 115.68,-298.49 106.46,-293.28 105.22,-300.17"/>
</g>
<!-- proc~lu1msp -->
<g id="proc~~lu1fad~~CallsGraph_node9" class="node">
<title>proc~lu1msp</title>
<g id="a_proc~~lu1fad~~CallsGraph_node9"><a xlink:href=".././proc/lu1msp.html" xlink:title="lusol::lu1mSP">
<polygon fill="#d9534f" stroke="#d9534f" points="201,-276 116,-276 116,-252 201,-252 201,-276"/>
<text text-anchor="middle" x="158.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1mSP</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1msp -->
<g id="proc~~lu1fad~~CallsGraph_edge8" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1msp</title>
<path fill="none" stroke="#000000" d="M79.13,-278.07C87.65,-276.54 96.79,-274.9 105.73,-273.29"/>
<polygon fill="#000000" stroke="#000000" points="106.46,-276.72 115.68,-271.51 105.22,-269.83 106.46,-276.72"/>
</g>
<!-- proc~lu1mxc -->
<g id="proc~~lu1fad~~CallsGraph_node10" class="node">
<title>proc~lu1mxc</title>
<g id="a_proc~~lu1fad~~CallsGraph_node10"><a xlink:href=".././proc/lu1mxc.html" xlink:title="lusol::lu1mxc">
<polygon fill="#d9534f" stroke="#d9534f" points="200.5,-234 116.5,-234 116.5,-210 200.5,-210 200.5,-234"/>
<text text-anchor="middle" x="158.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1mxc</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1mxc -->
<g id="proc~~lu1fad~~CallsGraph_edge9" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1mxc</title>
<path fill="none" stroke="#000000" d="M61.21,-272.93C76.06,-264.36 96.62,-252.71 115,-243 117.68,-241.58 120.47,-240.14 123.27,-238.71"/>
<polygon fill="#000000" stroke="#000000" points="124.85,-241.83 132.22,-234.21 121.71,-235.58 124.85,-241.83"/>
</g>
<!-- proc~lu1mxr -->
<g id="proc~~lu1fad~~CallsGraph_node11" class="node">
<title>proc~lu1mxr</title>
<g id="a_proc~~lu1fad~~CallsGraph_node11"><a xlink:href=".././proc/lu1mxr.html" xlink:title="lusol::lu1mxr">
<polygon fill="#d9534f" stroke="#d9534f" points="199.5,-192 117.5,-192 117.5,-168 199.5,-168 199.5,-192"/>
<text text-anchor="middle" x="158.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1mxr</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1mxr -->
<g id="proc~~lu1fad~~CallsGraph_edge10" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1mxr</title>
<path fill="none" stroke="#000000" d="M48.93,-272.82C61.61,-255.17 87.11,-222.29 115,-201 116.75,-199.66 118.61,-198.37 120.52,-197.14"/>
<polygon fill="#000000" stroke="#000000" points="122.29,-200.16 129.15,-192.08 118.75,-194.11 122.29,-200.16"/>
</g>
<!-- proc~lu1pen -->
<g id="proc~~lu1fad~~CallsGraph_node12" class="node">
<title>proc~lu1pen</title>
<g id="a_proc~~lu1fad~~CallsGraph_node12"><a xlink:href=".././proc/lu1pen.html" xlink:title="lusol::lu1pen">
<polygon fill="#d9534f" stroke="#d9534f" points="199.5,-150 117.5,-150 117.5,-126 199.5,-126 199.5,-150"/>
<text text-anchor="middle" x="158.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1pen</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1pen -->
<g id="proc~~lu1fad~~CallsGraph_edge11" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1pen</title>
<path fill="none" stroke="#000000" d="M44.99,-272.69C54.46,-248.17 78.67,-192.7 115,-159 116.13,-157.95 117.32,-156.94 118.57,-155.97"/>
<polygon fill="#000000" stroke="#000000" points="120.89,-158.63 127.28,-150.17 117.01,-152.8 120.89,-158.63"/>
</g>
<!-- proc~lu1pq2 -->
<g id="proc~~lu1fad~~CallsGraph_node13" class="node">
<title>proc~lu1pq2</title>
<g id="a_proc~~lu1fad~~CallsGraph_node13"><a xlink:href=".././proc/lu1pq2.html" xlink:title="lusol::lu1pq2">
<polygon fill="#d9534f" stroke="#d9534f" points="199.5,-108 117.5,-108 117.5,-84 199.5,-84 199.5,-108"/>
<text text-anchor="middle" x="158.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1pq2</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1pq2 -->
<g id="proc~~lu1fad~~CallsGraph_edge12" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1pq2</title>
<path fill="none" stroke="#000000" d="M42.9,-272.83C49.39,-242.76 69.94,-163.97 115,-117 116.03,-115.92 117.13,-114.89 118.28,-113.91"/>
<polygon fill="#000000" stroke="#000000" points="120.37,-116.72 126.49,-108.07 116.31,-111.02 120.37,-116.72"/>
</g>
<!-- proc~lu1pq3 -->
<g id="proc~~lu1fad~~CallsGraph_node14" class="node">
<title>proc~lu1pq3</title>
<g id="a_proc~~lu1fad~~CallsGraph_node14"><a xlink:href=".././proc/lu1pq3.html" xlink:title="lusol::lu1pq3">
<polygon fill="#d9534f" stroke="#d9534f" points="199.5,-66 117.5,-66 117.5,-42 199.5,-42 199.5,-66"/>
<text text-anchor="middle" x="158.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1pq3</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1pq3 -->
<g id="proc~~lu1fad~~CallsGraph_edge13" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1pq3</title>
<path fill="none" stroke="#000000" d="M41.63,-272.98C45.48,-238.14 61.04,-135.73 115,-75 115.86,-74.03 116.78,-73.1 117.74,-72.21"/>
<polygon fill="#000000" stroke="#000000" points="119.94,-74.93 125.82,-66.12 115.73,-69.34 119.94,-74.93"/>
</g>
<!-- proc~lu1rec -->
<g id="proc~~lu1fad~~CallsGraph_node15" class="node">
<title>proc~lu1rec</title>
<g id="a_proc~~lu1fad~~CallsGraph_node15"><a xlink:href=".././proc/lu1rec.html" xlink:title="lusol::lu1rec">
<polygon fill="#d9534f" stroke="#d9534f" points="197.5,-24 119.5,-24 119.5,0 197.5,0 197.5,-24"/>
<text text-anchor="middle" x="158.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1rec</text>
</a>
</g>
</g>
<!-- proc~lu1fad&#45;&gt;proc~lu1rec -->
<g id="proc~~lu1fad~~CallsGraph_edge14" class="edge">
<title>proc~lu1fad&#45;&gt;proc~lu1rec</title>
<path fill="none" stroke="#000000" d="M40.78,-272.91C42.31,-233.6 52.13,-107.69 115,-33 115.72,-32.15 116.47,-31.33 117.27,-30.54"/>
<polygon fill="#000000" stroke="#000000" points="119.56,-33.19 125.22,-24.24 115.21,-27.71 119.56,-33.19"/>
</g>
<!-- proc~hinsert -->
<g id="proc~~lu1fad~~CallsGraph_node17" class="node">
<title>proc~hinsert</title>
<g id="a_proc~~lu1fad~~CallsGraph_node17"><a xlink:href=".././proc/hinsert.html" xlink:title="lusol::Hinsert">
<polygon fill="#d9534f" stroke="#d9534f" points="326,-566 243,-566 243,-542 326,-542 326,-566"/>
<text text-anchor="middle" x="284.5" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hinsert</text>
</a>
</g>
</g>
<!-- proc~hbuild&#45;&gt;proc~hinsert -->
<g id="proc~~lu1fad~~CallsGraph_edge15" class="edge">
<title>proc~hbuild&#45;&gt;proc~hinsert</title>
<path fill="none" stroke="#000000" d="M198.05,-554C209.05,-554 221.2,-554 232.81,-554"/>
<polygon fill="#000000" stroke="#000000" points="232.82,-557.5 242.82,-554 232.82,-550.5 232.82,-557.5"/>
</g>
<!-- proc~hdown -->
<g id="proc~~lu1fad~~CallsGraph_node16" class="node">
<title>proc~hdown</title>
<g id="a_proc~~lu1fad~~CallsGraph_node16"><a xlink:href=".././proc/hdown.html" xlink:title="lusol::Hdown">
<polygon fill="#d9534f" stroke="#d9534f" points="450.5,-524 368.5,-524 368.5,-500 450.5,-500 450.5,-524"/>
<text text-anchor="middle" x="409.5" y="-509.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hdown</text>
</a>
</g>
</g>
<!-- proc~hchange&#45;&gt;proc~hdown -->
<g id="proc~~lu1fad~~CallsGraph_edge16" class="edge">
<title>proc~hchange&#45;&gt;proc~hdown</title>
<path fill="none" stroke="#000000" d="M331.3,-512C340.04,-512 349.23,-512 358.1,-512"/>
<polygon fill="#000000" stroke="#000000" points="358.33,-515.5 368.33,-512 358.33,-508.5 358.33,-515.5"/>
</g>
<!-- proc~hup -->
<g id="proc~~lu1fad~~CallsGraph_node18" class="node">
<title>proc~hup</title>
<g id="a_proc~~lu1fad~~CallsGraph_node18"><a xlink:href=".././proc/hup.html" xlink:title="lusol::Hup">
<polygon fill="#d9534f" stroke="#d9534f" points="443,-566 376,-566 376,-542 443,-542 443,-566"/>
<text text-anchor="middle" x="409.5" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::Hup</text>
</a>
</g>
</g>
<!-- proc~hchange&#45;&gt;proc~hup -->
<g id="proc~~lu1fad~~CallsGraph_edge17" class="edge">
<title>proc~hchange&#45;&gt;proc~hup</title>
<path fill="none" stroke="#000000" d="M320.75,-524.04C334.96,-528.89 351.47,-534.53 366.31,-539.59"/>
<polygon fill="#000000" stroke="#000000" points="365.18,-542.91 375.78,-542.83 367.45,-536.28 365.18,-542.91"/>
</g>
<!-- proc~hdelete&#45;&gt;proc~hchange -->
<g id="proc~~lu1fad~~CallsGraph_edge18" class="edge">
<title>proc~hdelete&#45;&gt;proc~hchange</title>
<path fill="none" stroke="#000000" d="M198.73,-486.02C210.04,-489.49 222.52,-493.31 234.35,-496.94"/>
<polygon fill="#000000" stroke="#000000" points="233.51,-500.34 244.1,-499.92 235.56,-493.65 233.51,-500.34"/>
</g>
<!-- proc~lu1dcp -->
<g id="proc~~lu1fad~~CallsGraph_node19" class="node">
<title>proc~lu1dcp</title>
<g id="a_proc~~lu1fad~~CallsGraph_node19"><a xlink:href=".././proc/lu1dcp.html" xlink:title="lusol::lu1DCP">
<polygon fill="#d9534f" stroke="#d9534f" points="326,-463 243,-463 243,-439 326,-439 326,-463"/>
<text text-anchor="middle" x="284.5" y="-448.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1DCP</text>
</a>
</g>
</g>
<!-- proc~lu1ful&#45;&gt;proc~lu1dcp -->
<g id="proc~~lu1fad~~CallsGraph_edge19" class="edge">
<title>proc~lu1ful&#45;&gt;proc~lu1dcp</title>
<path fill="none" stroke="#000000" d="M196.03,-437.6C207.53,-439.36 220.44,-441.34 232.74,-443.22"/>
<polygon fill="#000000" stroke="#000000" points="232.47,-446.72 242.89,-444.78 233.53,-439.8 232.47,-446.72"/>
</g>
<!-- proc~lu1dpp -->
<g id="proc~~lu1fad~~CallsGraph_node20" class="node">
<title>proc~lu1dpp</title>
<g id="a_proc~~lu1fad~~CallsGraph_node20"><a xlink:href=".././proc/lu1dpp.html" xlink:title="lusol::lu1DPP">
<polygon fill="#d9534f" stroke="#d9534f" points="325.5,-421 243.5,-421 243.5,-397 325.5,-397 325.5,-421"/>
<text text-anchor="middle" x="284.5" y="-406.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1DPP</text>
</a>
</g>
</g>
<!-- proc~lu1ful&#45;&gt;proc~lu1dpp -->
<g id="proc~~lu1fad~~CallsGraph_edge20" class="edge">
<title>proc~lu1ful&#45;&gt;proc~lu1dpp</title>
<path fill="none" stroke="#000000" d="M196.03,-425.22C207.76,-423.05 220.95,-420.6 233.47,-418.28"/>
<polygon fill="#000000" stroke="#000000" points="234.13,-421.72 243.33,-416.45 232.86,-414.83 234.13,-421.72"/>
</g>
<!-- proc~hinsert&#45;&gt;proc~hup -->
<g id="proc~~lu1fad~~CallsGraph_edge21" class="edge">
<title>proc~hinsert&#45;&gt;proc~hup</title>
<path fill="none" stroke="#000000" d="M326.12,-554C338.69,-554 352.58,-554 365.33,-554"/>
<polygon fill="#000000" stroke="#000000" points="365.7,-557.5 375.7,-554 365.7,-550.5 365.7,-557.5"/>
</g>
<!-- proc~jdamax -->
<g id="proc~~lu1fad~~CallsGraph_node21" class="node">
<title>proc~jdamax</title>
<g id="a_proc~~lu1fad~~CallsGraph_node21"><a xlink:href=".././proc/jdamax.html" xlink:title="lusol::jdamax">
<polygon fill="#d94e8f" stroke="#d94e8f" points="452,-442 367,-442 367,-418 452,-418 452,-442"/>
<text text-anchor="middle" x="409.5" y="-427.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::jdamax</text>
</a>
</g>
</g>
<!-- proc~lu1dcp&#45;&gt;proc~jdamax -->
<g id="proc~~lu1fad~~CallsGraph_edge22" class="edge">
<title>proc~lu1dcp&#45;&gt;proc~jdamax</title>
<path fill="none" stroke="#000000" d="M326.12,-444.07C335.88,-442.4 346.44,-440.6 356.63,-438.86"/>
<polygon fill="#000000" stroke="#000000" points="357.4,-442.28 366.66,-437.14 356.22,-435.38 357.4,-442.28"/>
</g>
<!-- proc~lu1dpp&#45;&gt;proc~jdamax -->
<g id="proc~~lu1fad~~CallsGraph_edge23" class="edge">
<title>proc~lu1dpp&#45;&gt;proc~jdamax</title>
<path fill="none" stroke="#000000" d="M325.77,-415.88C335.65,-417.56 346.37,-419.39 356.7,-421.16"/>
<polygon fill="#000000" stroke="#000000" points="356.42,-424.66 366.87,-422.89 357.6,-417.76 356.42,-424.66"/>
</g>
</g>
</svg>
</div>        <div><a type="button" class="graph-help" data-toggle="modal" href="#CallsGraph-help-text">Help</a></div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                </div>
              <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.16 1.16) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lu1fad~~CalledByGraph Pages: 1 -->
<svg id="proclu1fadCalledByGraph" width="578pt" height="74pt"
 viewBox="0.00 0.00 578.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lu1fad~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>proc~~lu1fad~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-70 574,-70 574,4 -4,4"/>
<!-- proc~lu1fad -->
<g id="proc~~lu1fad~~CalledByGraph_node1" class="node">
<title>proc~lu1fad</title>
<polygon fill="none" stroke="black" points="570,-45 491,-45 491,-21 570,-21 570,-45"/>
<text text-anchor="middle" x="530.5" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50">lusol::lu1fad</text>
</g>
<!-- proc~lu1fac -->
<g id="proc~~lu1fad~~CalledByGraph_node2" class="node">
<title>proc~lu1fac</title>
<g id="a_proc~~lu1fad~~CalledByGraph_node2"><a xlink:href=".././proc/lu1fac.html" xlink:title="lusol::lu1fac">
<polygon fill="#d9534f" stroke="#d9534f" points="455,-45 377,-45 377,-21 455,-21 455,-45"/>
<text text-anchor="middle" x="416" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol::lu1fac</text>
</a>
</g>
</g>
<!-- proc~lu1fac&#45;&gt;proc~lu1fad -->
<g id="proc~~lu1fad~~CalledByGraph_edge1" class="edge">
<title>proc~lu1fac&#45;&gt;proc~lu1fad</title>
<path fill="none" stroke="#000000" d="M455.09,-33C463.24,-33 471.97,-33 480.48,-33"/>
<polygon fill="#000000" stroke="#000000" points="480.69,-36.5 490.69,-33 480.69,-29.5 480.69,-36.5"/>
</g>
<!-- proc~solve -->
<g id="proc~~lu1fad~~CalledByGraph_node3" class="node">
<title>proc~solve</title>
<g id="a_proc~~lu1fad~~CalledByGraph_node3"><a xlink:href=".././proc/solve.html" xlink:title="lusol_ez_module::solve">
<polygon fill="#d9534f" stroke="#d9534f" points="341,-45 205,-45 205,-21 341,-21 341,-45"/>
<text text-anchor="middle" x="273" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lusol_ez_module::solve</text>
</a>
</g>
</g>
<!-- proc~solve&#45;&gt;proc~lu1fac -->
<g id="proc~~lu1fad~~CalledByGraph_edge2" class="edge">
<title>proc~solve&#45;&gt;proc~lu1fac</title>
<path fill="none" stroke="#000000" d="M341.2,-33C349.77,-33 358.42,-33 366.62,-33"/>
<polygon fill="#000000" stroke="#000000" points="366.73,-36.5 376.73,-33 366.73,-29.5 366.73,-36.5"/>
</g>
<!-- proc~test_1 -->
<g id="proc~~lu1fad~~CalledByGraph_node4" class="node">
<title>proc~test_1</title>
<g id="a_proc~~lu1fad~~CalledByGraph_node4"><a xlink:href=".././proc/test_1.html" xlink:title="main::test_1">
<polygon fill="#d9534f" stroke="#d9534f" points="169,-66 90,-66 90,-42 169,-42 169,-66"/>
<text text-anchor="middle" x="129.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main::test_1</text>
</a>
</g>
</g>
<!-- proc~test_1&#45;&gt;proc~solve -->
<g id="proc~~lu1fad~~CalledByGraph_edge3" class="edge">
<title>proc~test_1&#45;&gt;proc~solve</title>
<path fill="none" stroke="#000000" d="M169.17,-48.26C177.19,-47.07 185.92,-45.78 194.78,-44.46"/>
<polygon fill="#000000" stroke="#000000" points="195.43,-47.9 204.81,-42.97 194.41,-40.98 195.43,-47.9"/>
</g>
<!-- proc~test_2 -->
<g id="proc~~lu1fad~~CalledByGraph_node5" class="node">
<title>proc~test_2</title>
<g id="a_proc~~lu1fad~~CalledByGraph_node5"><a xlink:href=".././proc/test_2.html" xlink:title="main::test_2">
<polygon fill="#d9534f" stroke="#d9534f" points="169,-24 90,-24 90,0 169,0 169,-24"/>
<text text-anchor="middle" x="129.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main::test_2</text>
</a>
</g>
</g>
<!-- proc~test_2&#45;&gt;proc~solve -->
<g id="proc~~lu1fad~~CalledByGraph_edge4" class="edge">
<title>proc~test_2&#45;&gt;proc~solve</title>
<path fill="none" stroke="#000000" d="M169.17,-17.74C177.19,-18.93 185.92,-20.22 194.78,-21.54"/>
<polygon fill="#000000" stroke="#000000" points="194.41,-25.02 204.81,-23.03 195.43,-18.1 194.41,-25.02"/>
</g>
<!-- program~main -->
<g id="proc~~lu1fad~~CalledByGraph_node6" class="node">
<title>program~main</title>
<g id="a_proc~~lu1fad~~CalledByGraph_node6"><a xlink:href=".././program/main.html" xlink:title="main">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="54,-45 0,-45 0,-21 54,-21 54,-45"/>
<text text-anchor="middle" x="27" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main</text>
</a>
</g>
</g>
<!-- program~main&#45;&gt;proc~test_1 -->
<g id="proc~~lu1fad~~CalledByGraph_edge5" class="edge">
<title>program~main&#45;&gt;proc~test_1</title>
<path fill="none" stroke="#000000" d="M54.14,-38.46C62.09,-40.12 71.08,-42 80.01,-43.87"/>
<polygon fill="#000000" stroke="#000000" points="79.49,-47.33 89.99,-45.95 80.92,-40.48 79.49,-47.33"/>
</g>
<!-- program~main&#45;&gt;proc~test_2 -->
<g id="proc~~lu1fad~~CalledByGraph_edge6" class="edge">
<title>program~main&#45;&gt;proc~test_2</title>
<path fill="none" stroke="#000000" d="M54.14,-27.54C62.09,-25.88 71.08,-24 80.01,-22.13"/>
<polygon fill="#000000" stroke="#000000" points="80.92,-25.52 89.99,-20.05 79.49,-18.67 80.92,-25.52"/>
</g>
</g>
</svg>
</div>        <div><a type="button" class="graph-help" data-toggle="modal" href="#CalledByGraph-help-text">Help</a></div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                </div>
              <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1.16 1.16) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">  </span><span class="k">subroutine </span><span class="n">lu1fad</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">parmlu</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">a</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w">     </span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">lenc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w">  </span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">iploc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ipinv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iqinv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="w">     </span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">lenH</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">Ha</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Hj</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Hk</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Amaxr</span><span class="w"> </span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">inform</span><span class="p">,</span><span class="w"> </span><span class="n">lenL</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenU</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">minlen</span><span class="p">,</span><span class="w"> </span><span class="n">mersum</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">nUtri</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nLtri</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ndens1</span><span class="p">,</span><span class="w"> </span><span class="n">ndens2</span><span class="p">,</span><span class="w"> </span><span class="n">nrank</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nslack</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">Lmax</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">Umax</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">DUmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DUmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Akmax</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">lenH</span><span class="p">,</span><span class="w"> </span><span class="n">nslack</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lena</span><span class="p">),</span><span class="w"> </span><span class="n">Amaxr</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">w</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">Ha</span><span class="p">(</span><span class="n">lenH</span><span class="p">)</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lena</span><span class="p">),</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lena</span><span class="p">),</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">p</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">    </span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">lenc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">   </span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">locc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">iploc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">  </span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">ipinv</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">iqinv</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">Hj</span><span class="p">(</span><span class="n">lenH</span><span class="p">)</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">Hk</span><span class="p">(</span><span class="n">lenH</span><span class="p">)</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span><span class="w">   </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">inform</span><span class="p">,</span><span class="w"> </span><span class="n">lenL</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenU</span><span class="w">  </span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">minlen</span><span class="p">,</span><span class="w"> </span><span class="n">mersum</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">nUtri</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nLtri</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ndens1</span><span class="p">,</span><span class="w"> </span><span class="n">ndens2</span><span class="p">,</span><span class="w"> </span><span class="n">nrank</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span><span class="w">      </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">Lmax</span><span class="p">,</span><span class="w"> </span><span class="n">Umax</span><span class="p">,</span><span class="w"> </span><span class="n">DUmax</span><span class="p">,</span><span class="w"> </span><span class="n">DUmin</span><span class="p">,</span><span class="w"> </span><span class="n">Akmax</span>

<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! lu1fad  is a driver for the numerical phase of lu1fac.</span>
<span class="w">    </span><span class="c">! At each stage it computes a column of  L  and a row of  U,</span>
<span class="w">    </span><span class="c">! using a Markowitz criterion to select the pivot element,</span>
<span class="w">    </span><span class="c">! subject to a stability criterion that bounds the elements of  L.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 00 Jan 1986  Version documented in LUSOL paper:</span>
<span class="w">    </span><span class="c">!              Gill, Murray, Saunders and Wright (1987),</span>
<span class="w">    </span><span class="c">!              Maintaining LU factors of a general sparse matrix,</span>
<span class="w">    </span><span class="c">!              Linear algebra and its applications 88/89, 239-270.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 02 Feb 1989  Following Suhl and Aittoniemi (1987), the largest</span>
<span class="w">    </span><span class="c">!              element in each column is now kept at the start of</span>
<span class="w">    </span><span class="c">!              the column, i.e. in position locc(j) of a and indc.</span>
<span class="w">    </span><span class="c">!              This should speed up the Markowitz searches.</span>
<span class="w">    </span><span class="c">!              To save time on highly triangular matrices, we wait</span>
<span class="w">    </span><span class="c">!              until there are no further columns of length 1</span>
<span class="w">    </span><span class="c">!              before setting and maintaining that property.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 12 Apr 1989  ipinv and iqinv added (inverses of p and q)</span>
<span class="w">    </span><span class="c">!              to save searching p and q for rows and columns</span>
<span class="w">    </span><span class="c">!              altered in each elimination step.  (Used in lu1pq2)</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 19 Apr 1989  Code segmented to reduce its size.</span>
<span class="w">    </span><span class="c">!              lu1gau does most of the Gaussian elimination work.</span>
<span class="w">    </span><span class="c">!              lu1mar does just the Markowitz search.</span>
<span class="w">    </span><span class="c">!              lu1mxc moves biggest elements to top of columns.</span>
<span class="w">    </span><span class="c">!              lu1pen deals with pending fill-in in the row list.</span>
<span class="w">    </span><span class="c">!              lu1pq2 updates the row and column permutations.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 26 Apr 1989  maxtie replaced by maxcol, maxrow in the Markowitz</span>
<span class="w">    </span><span class="c">!              search.  maxcol, maxrow change as density increases.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 25 Oct 1993  keepLU implemented.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 07 Feb 1994  Exit main loop early to finish off with a dense LU.</span>
<span class="w">    </span><span class="c">!              densLU tells lu1fad whether to do it.</span>
<span class="w">    </span><span class="c">! 21 Dec 1994  Bug fixed.  nrank was wrong after the call to lu1ful.</span>
<span class="w">    </span><span class="c">! 12 Nov 1999  A parallel version of dcopy gave trouble in lu1ful</span>
<span class="w">    </span><span class="c">!              during left-shift of dense matrix D within a(*).</span>
<span class="w">    </span><span class="c">!              Fixed this unexpected problem here in lu1fad</span>
<span class="w">    </span><span class="c">!              by making sure the first and second D don&#39;t overlap.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 13 Sep 2000  TCP (Threshold Complete Pivoting) implemented.</span>
<span class="w">    </span><span class="c">!              lu2max added</span>
<span class="w">    </span><span class="c">!              (finds aijmax from biggest elems in each col).</span>
<span class="w">    </span><span class="c">!              Utri, Ltri and Spars1 phases apply.</span>
<span class="w">    </span><span class="c">!              No switch to Dense CP yet.  (Only TPP switches.)</span>
<span class="w">    </span><span class="c">! 14 Sep 2000  imax needed to remember row containing aijmax.</span>
<span class="w">    </span><span class="c">! 22 Sep 2000  For simplicity, lu1mxc always fixes</span>
<span class="w">    </span><span class="c">!              all modified cols.</span>
<span class="w">    </span><span class="c">!              (TPP spars2 used to fix just the first maxcol cols.)</span>
<span class="w">    </span><span class="c">! 08 Nov 2000: Speed up search for aijmax.</span>
<span class="w">    </span><span class="c">!              Don&#39;t need to search all columns if the elimination</span>
<span class="w">    </span><span class="c">!              didn&#39;t alter the col containing the current aijmax.</span>
<span class="w">    </span><span class="c">! 21 Nov 2000: lu1slk implemented for Utri phase with TCP</span>
<span class="w">    </span><span class="c">!              to guard against deceptive triangular matrices.</span>
<span class="w">    </span><span class="c">!              (Utri used to have aijtol &gt;= 0.9999 to include</span>
<span class="w">    </span><span class="c">!              slacks, but this allows other 1s to be accepted.)</span>
<span class="w">    </span><span class="c">!              Utri now accepts slacks, but applies normal aijtol</span>
<span class="w">    </span><span class="c">!              test to other pivots.</span>
<span class="w">    </span><span class="c">! 28 Nov 2000: TCP with empty cols must call lu1mxc and lu2max</span>
<span class="w">    </span><span class="c">!              with ( lq1, n, ... ), not just ( 1, n, ... ).</span>
<span class="w">    </span><span class="c">! 23 Mar 2001: lu1fad bug with TCP.</span>
<span class="w">    </span><span class="c">!              A col of length 1 might not be accepted as a pivot.</span>
<span class="w">    </span><span class="c">!              Later it appears in a pivot row and temporarily</span>
<span class="w">    </span><span class="c">!              has length 0 (when pivot row is removed</span>
<span class="w">    </span><span class="c">!              but before the column is filled in).  If it is the</span>
<span class="w">    </span><span class="c">!              last column in storage, the preceding col also thinks</span>
<span class="w">    </span><span class="c">!              it is &quot;last&quot;.  Trouble arises when the preceding col</span>
<span class="w">    </span><span class="c">!              needs fill-in -- it overlaps the real &quot;last&quot; column.</span>
<span class="w">    </span><span class="c">!              (Very rarely, same trouble might have happened if</span>
<span class="w">    </span><span class="c">!              the drop tolerance caused columns to have length 0.)</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">!              Introduced ilast to record the last row in row file,</span>
<span class="w">    </span><span class="c">!                         jlast to record the last col in col file.</span>
<span class="w">    </span><span class="c">!              lu1rec returns ilast = indr(lrow + 1)</span>
<span class="w">    </span><span class="c">!                          or jlast = indc(lcol + 1).</span>
<span class="w">    </span><span class="c">!        ***   (Should be an output parameter, but didn&#39;t want to</span>
<span class="w">    </span><span class="c">!              alter lu1rec&#39;s parameter list.)</span>
<span class="w">    </span><span class="c">!              lu1rec also treats empty rows or cols safely.</span>
<span class="w">    </span><span class="c">!              (Doesn&#39;t eliminate them!)</span>
<span class="w">    </span><span class="c">!        ***   20 Dec 2015: Made ilast an output as it should be.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 26 Apr 2002: Heap routines added for TCP.</span>
<span class="w">    </span><span class="c">!              lu2max no longer needed.</span>
<span class="w">    </span><span class="c">!              imax, jmax used only for printing.</span>
<span class="w">    </span><span class="c">! 01 May 2002: lu1DCP implemented (dense complete pivoting).</span>
<span class="w">    </span><span class="c">!              Both TPP and TCP now switch to dense LU</span>
<span class="w">    </span><span class="c">!              when density exceeds dens2.</span>
<span class="w">    </span><span class="c">! 06 May 2002: In dense mode, store diag(U) in natural order.</span>
<span class="w">    </span><span class="c">! 09 May 2002: lu1mCP implemented (Markowitz TCP via heap).</span>
<span class="w">    </span><span class="c">! 11 Jun 2002: lu1mRP implemented (Markowitz TRP).</span>
<span class="w">    </span><span class="c">! 28 Jun 2002: Fixed call to lu1mxr.</span>
<span class="w">    </span><span class="c">! 14 Dec 2002: lu1mSP implemented (Markowitz TSP).</span>
<span class="w">    </span><span class="c">! 15 Dec 2002: Both TPP and TSP can grab cols of length 1</span>
<span class="w">    </span><span class="c">!              during Utri.</span>
<span class="w">    </span><span class="c">! 19 Dec 2004: Hdelete(...) has new input argument Hlenin.</span>
<span class="w">    </span><span class="c">! 26 Mar 2006: lu1fad returns nrank  = min( mrank, nrank )</span>
<span class="w">    </span><span class="c">!              and ignores nsing from lu1ful</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! 10 Jan 2010: First f90 version.</span>
<span class="w">    </span><span class="c">! 03 Apr 2013: lu1mxr recoded to improve efficiency of TRP.</span>
<span class="w">    </span><span class="c">! 12 Dec 2015: nslack is now an input.</span>
<span class="w">    </span><span class="c">! 20 Dec 2015: lu1rec returns ilast as output parameter.</span>
<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>

<span class="w">    </span><span class="kt">logical</span><span class="w">                </span><span class="kd">::</span><span class="w"> </span><span class="n">Utri</span><span class="p">,</span><span class="w"> </span><span class="n">Ltri</span><span class="p">,</span><span class="w"> </span><span class="n">spars1</span><span class="p">,</span><span class="w"> </span><span class="n">spars2</span><span class="p">,</span><span class="w"> </span><span class="n">dense</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">densLU</span><span class="p">,</span><span class="w"> </span><span class="n">keepLU</span><span class="p">,</span><span class="w"> </span><span class="n">TCP</span><span class="p">,</span><span class="w"> </span><span class="n">TPP</span><span class="p">,</span><span class="w"> </span><span class="n">TRP</span><span class="p">,</span><span class="w"> </span><span class="n">TSP</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span><span class="w">               </span><span class="kd">::</span><span class="w"> </span><span class="n">abest</span><span class="p">,</span><span class="w"> </span><span class="n">aijmax</span><span class="p">,</span><span class="w"> </span><span class="n">aijtol</span><span class="p">,</span><span class="w"> </span><span class="nb">amax</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">dens1</span><span class="p">,</span><span class="w"> </span><span class="n">dens2</span><span class="p">,</span><span class="w"> </span><span class="n">diag</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">Lij</span><span class="p">,</span><span class="w"> </span><span class="n">Ltol</span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="p">,</span><span class="w"> </span><span class="n">Uspace</span>

<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! Local variables</span>
<span class="w">    </span><span class="c">!---------------</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! lcol   is the length of the column file.  It points to the last</span>
<span class="w">    </span><span class="c">!        nonzero in the column list.</span>
<span class="w">    </span><span class="c">! lrow   is the analogous quantity for the row file.</span>
<span class="w">    </span><span class="c">! lfile  is the file length (lcol or lrow) after the most recent</span>
<span class="w">    </span><span class="c">!        compression of the column list or row list.</span>
<span class="w">    </span><span class="c">! nrowd  and  ncold  are the number of rows and columns in the</span>
<span class="w">    </span><span class="c">!        matrix defined by the pivot column and row.  They are the</span>
<span class="w">    </span><span class="c">!        dimensions of the submatrix D being altered at this stage.</span>
<span class="w">    </span><span class="c">! melim  and  nelim  are the number of rows and columns in the</span>
<span class="w">    </span><span class="c">!        same matrix D, excluding the pivot column and row.</span>
<span class="w">    </span><span class="c">! mleft  and  nleft  are the number of rows and columns</span>
<span class="w">    </span><span class="c">!        still left to be factored.</span>
<span class="w">    </span><span class="c">! nzchng is the increase in nonzeros in the matrix that remains</span>
<span class="w">    </span><span class="c">!        to be factored after the current elimination</span>
<span class="w">    </span><span class="c">!        (usually negative).</span>
<span class="w">    </span><span class="c">! nzleft is the number of nonzeros still left to be factored.</span>
<span class="w">    </span><span class="c">! nspare is the space we leave at the end of the last row or</span>
<span class="w">    </span><span class="c">!        column whenever a row or column is being moved to the end</span>
<span class="w">    </span><span class="c">!        of its file.  nspare = 1 or 2 might help reduce the</span>
<span class="w">    </span><span class="c">!        number of file compressions when storage is tight.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! The row and column ordering permutes A into the form</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">!                        ------------------------</span>
<span class="w">    </span><span class="c">!                         \                     |</span>
<span class="w">    </span><span class="c">!                          \         U1         |</span>
<span class="w">    </span><span class="c">!                           \                   |</span>
<span class="w">    </span><span class="c">!                            --------------------</span>
<span class="w">    </span><span class="c">!                            |\</span>
<span class="w">    </span><span class="c">!                            | \</span>
<span class="w">    </span><span class="c">!                            |  \</span>
<span class="w">    </span><span class="c">!            P A Q   =       |   \</span>
<span class="w">    </span><span class="c">!                            |    \</span>
<span class="w">    </span><span class="c">!                            |     --------------</span>
<span class="w">    </span><span class="c">!                            |     |            |</span>
<span class="w">    </span><span class="c">!                            |     |            |</span>
<span class="w">    </span><span class="c">!                            | L1  |     A2     |</span>
<span class="w">    </span><span class="c">!                            |     |            |</span>
<span class="w">    </span><span class="c">!                            |     |            |</span>
<span class="w">    </span><span class="c">!                            --------------------</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! where the block A2 is factored as  A2 = L2 U2.</span>
<span class="w">    </span><span class="c">! The phases of the factorization are as follows.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! Utri   is true when U1 is being determined.</span>
<span class="w">    </span><span class="c">!        Any column of length 1 is accepted immediately (if TPP).</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! Ltri   is true when L1 is being determined.</span>
<span class="w">    </span><span class="c">!        lu1mar exits as soon as an acceptable pivot is found</span>
<span class="w">    </span><span class="c">!        in a row of length 1.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! spars1 is true while the density of the (modified) A2 is less</span>
<span class="w">    </span><span class="c">!        than the parameter dens1 = parmlu(7) = 0.3 say.</span>
<span class="w">    </span><span class="c">!        lu1mar searches maxcol columns and maxrow rows,</span>
<span class="w">    </span><span class="c">!        where  maxcol = luparm(3),  maxrow = maxcol - 1.</span>
<span class="w">    </span><span class="c">!        lu1mxc is used to keep the biggest element at the top</span>
<span class="w">    </span><span class="c">!        of all remaining columns.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! spars2 is true while the density of the modified A2 is less</span>
<span class="w">    </span><span class="c">!        than the parameter dens2 = parmlu(8) = 0.6 say.</span>
<span class="w">    </span><span class="c">!        lu1mar searches maxcol columns and no rows.</span>
<span class="w">    </span><span class="c">!        lu1mxc could fix up only the first maxcol cols (with TPP).</span>
<span class="w">    </span><span class="c">!        22 Sep 2000: For simplicity, lu1mxc fixes all modified cols.</span>
<span class="w">    </span><span class="c">!</span>
<span class="w">    </span><span class="c">! dense  is true once the density of A2 reaches dens2.</span>
<span class="w">    </span><span class="c">!        lu1mar searches only 1 column (the shortest).</span>
<span class="w">    </span><span class="c">!        lu1mxc could fix up only the first column (with TPP).</span>
<span class="w">    </span><span class="c">!        22 Sep 2000: For simplicity, lu1mxc fixes all modified cols.</span>
<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>

<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">Hlen</span><span class="p">,</span><span class="w"> </span><span class="n">Hlenin</span><span class="p">,</span><span class="w"> </span><span class="n">hops</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="p">,</span><span class="w"> </span><span class="n">imax</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="p">,</span><span class="w"> </span><span class="n">jlast</span><span class="p">,</span><span class="w"> </span><span class="n">jmax</span><span class="p">,</span><span class="w"> </span><span class="n">lPiv</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kbest</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="p">,</span><span class="w"> </span><span class="n">kslack</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">,</span><span class="w"> </span><span class="n">lc</span><span class="p">,</span><span class="w"> </span><span class="n">lc1</span><span class="p">,</span><span class="w"> </span><span class="n">lcol</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">lD</span><span class="p">,</span><span class="w"> </span><span class="n">ldiagU</span><span class="p">,</span><span class="w"> </span><span class="n">lenD</span><span class="p">,</span><span class="w"> </span><span class="n">leni</span><span class="p">,</span><span class="w"> </span><span class="n">lenj</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">lfile</span><span class="p">,</span><span class="w"> </span><span class="n">lfirst</span><span class="p">,</span><span class="w"> </span><span class="n">lfree</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="n">ll1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">lpivr</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span><span class="p">,</span><span class="w"> </span><span class="n">lprint</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">lq</span><span class="p">,</span><span class="w"> </span><span class="n">lq1</span><span class="p">,</span><span class="w"> </span><span class="n">lq2</span><span class="p">,</span><span class="w"> </span><span class="n">lr</span><span class="p">,</span><span class="w"> </span><span class="n">lr1</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">lrow</span><span class="p">,</span><span class="w"> </span><span class="n">ls</span><span class="p">,</span><span class="w"> </span><span class="n">lsave</span><span class="p">,</span><span class="w"> </span><span class="n">lu</span><span class="p">,</span><span class="w"> </span><span class="n">lu1</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">mark</span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w"> </span><span class="n">maxrow</span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">melim</span><span class="p">,</span><span class="w"> </span><span class="n">minfre</span><span class="p">,</span><span class="w"> </span><span class="n">minmn</span><span class="p">,</span><span class="w"> </span><span class="n">mleft</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">mrank</span><span class="p">,</span><span class="w"> </span><span class="n">ncold</span><span class="p">,</span><span class="w"> </span><span class="n">nelim</span><span class="p">,</span><span class="w"> </span><span class="n">nfill</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">nfree</span><span class="p">,</span><span class="w"> </span><span class="n">nleft</span><span class="p">,</span><span class="w"> </span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="n">nrowd</span><span class="p">,</span><span class="w"> </span><span class="n">nrowu</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">nsing</span><span class="p">,</span><span class="w"> </span><span class="n">nspare</span><span class="p">,</span><span class="w"> </span><span class="n">nzchng</span><span class="p">,</span><span class="w"> </span><span class="n">nzleft</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">markc</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">markr</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span><span class="w">          </span><span class="kd">::</span><span class="w"> </span><span class="n">v</span>

<span class="w">    </span><span class="n">nout</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">lprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="n">maxcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="n">lPiv</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">keepLU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">luparm</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">TPP</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lPiv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c">! Threshold Partial   Pivoting (normal).</span>
<span class="w">    </span><span class="n">TRP</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lPiv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">! Threshold Rook      Pivoting</span>
<span class="w">    </span><span class="n">TCP</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lPiv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c">! Threshold Complete  Pivoting.</span>
<span class="w">    </span><span class="n">TSP</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lPiv</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span><span class="c">! Threshold Symmetric Pivoting.</span>

<span class="w">    </span><span class="n">densLU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="n">maxrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxcol</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">ilast</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w">                 </span><span class="c">! Assume row m is last in the row file.</span>
<span class="w">    </span><span class="n">jlast</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w">                 </span><span class="c">! Assume col n is last in the col file.</span>
<span class="w">    </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nelem</span>
<span class="w">    </span><span class="n">lrow</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">nelem</span>
<span class="w">    </span><span class="n">lcol</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">nelem</span>
<span class="w">    </span><span class="n">minmn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">maxmn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">nzleft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nelem</span>
<span class="w">    </span><span class="n">nspare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">ldiagU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                 </span><span class="c">! Keep -Wmaybe-uninitialized happy.</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">keepLU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">       </span><span class="n">lu1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lena</span><span class="w">   </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="c">! Store only the diagonals of U in the top of memory.</span>
<span class="w">       </span><span class="n">ldiagU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lena</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">n</span>
<span class="w">       </span><span class="n">lu1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ldiagU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    </span><span class="n">Ltol</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">small</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="n">Uspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">dens1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span><span class="n">dens2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">parmlu</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">Utri</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">    </span><span class="n">Ltri</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="n">spars1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="n">spars2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="n">dense</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">    </span><span class="n">kslack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">        </span><span class="c">! 12 Dec 2015: Count slacks accepted during Utri.</span>

<span class="w">    </span><span class="c">! Check parameters.</span>

<span class="w">    </span><span class="n">Ltol</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">Ltol</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0001_rp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">dens1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">dens1</span><span class="p">,</span><span class="w"> </span><span class="n">dens2</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="c">! Initialize output parameters.</span>
<span class="w">    </span><span class="c">! lenL, lenU, minlen, mersum, nUtri, nLtri, ndens1, ndens2, nrank,</span>
<span class="w">    </span><span class="c">! nslack, are already initialized by lu1fac.</span>

<span class="w">    </span><span class="n">lenL</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">lenU</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">minlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">mersum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">nLtri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">nUtri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">ndens1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">ndens2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">nrank</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">Lmax</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">    </span><span class="n">Umax</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">    </span><span class="n">DUmax</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">    </span><span class="n">DUmin</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e+20_rp</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nelem</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">Dumin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">    </span><span class="n">Akmax</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">    </span><span class="n">hops</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="c">! More initialization.</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TSP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Don&#39;t worry yet about lu1mxc.</span>
<span class="w">       </span><span class="n">aijmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">       </span><span class="n">aijtol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">       </span><span class="n">Hlen</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="c">! TRP or TCP</span>
<span class="w">       </span><span class="c">! Move biggest element to top of each column.</span>
<span class="w">       </span><span class="c">! Set w(*) to mark slack columns (unit vectors).</span>
<span class="w">       </span><span class="c">! 12 Dec 2015: lu1fac (lu1slk) sets w(*) before lu1fad.</span>
<span class="w">       </span><span class="c">! 13 Dec 2015: lu1mxc fixed (empty cols caused trouble).</span>

<span class="w">       </span><span class="k">call </span><span class="n">lu1mxc</span><span class="p">(</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>
<span class="w">     </span><span class="c">! call lu1slk( m, n, lena, q, iqloc, a, locc, w )</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">TRP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Find biggest element in each row.</span>
<span class="w">       </span><span class="n">mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">       </span><span class="k">call </span><span class="n">lu1mxr</span><span class="p">(</span><span class="w"> </span><span class="n">mark</span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">inform</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">markc</span><span class="p">,</span><span class="w"> </span><span class="n">markr</span><span class="p">,</span><span class="w"> </span><span class="n">Amaxr</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inform</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">981</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Set Ha(1:Hlen) = biggest element in each column,</span>
<span class="w">                  </span><span class="c">! Hj(1:Hlen) = corresponding column indices.</span>
<span class="w">                  </span><span class="c">! 17 Dec 2015: Allow for empty columns.</span>
<span class="w">       </span><span class="n">Hlen</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">       </span><span class="k">do </span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">          </span><span class="n">Hlen</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">Hlen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">j</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lenc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             </span><span class="n">lc</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">             </span><span class="nb">amax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="k">else</span>
<span class="k">             </span><span class="nb">amax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">          </span><span class="n">Ha</span><span class="p">(</span><span class="n">Hlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">amax</span>
<span class="nb">          </span><span class="n">Hj</span><span class="p">(</span><span class="n">Hlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span>
<span class="w">          </span><span class="n">Hk</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Hlen</span>
<span class="w">       </span><span class="k">end do</span>

<span class="w">       </span><span class="c">! Build the heap, creating new Ha, Hj and setting Hk(1:Hlen).</span>

<span class="w">       </span><span class="k">call </span><span class="n">Hbuild</span><span class="p">(</span><span class="w"> </span><span class="n">Ha</span><span class="p">,</span><span class="w"> </span><span class="n">Hj</span><span class="p">,</span><span class="w"> </span><span class="n">Hk</span><span class="p">,</span><span class="w"> </span><span class="n">Hlen</span><span class="p">,</span><span class="w"> </span><span class="n">Hlen</span><span class="p">,</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">end if</span>

<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! Start of main loop.</span>
<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="n">mleft</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">nleft</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">do </span><span class="mi">800</span><span class="w"> </span><span class="n">nrowu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">minmn</span>

<span class="w">       </span><span class="c">! mktime = (nrowu / ntime) + 4</span>
<span class="w">       </span><span class="c">! eltime = (nrowu / ntime) + 9</span>
<span class="w">       </span><span class="n">mleft</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mleft</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">nleft</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nleft</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">       </span><span class="c">! Bail out if there are no nonzero rows left.</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iploc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">900</span>

<span class="w">       </span><span class="c">! For TCP, the largest Aij is at the top of the heap.</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">aijmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ha</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="c">! Marvelously easy !</span>
<span class="w">          </span><span class="n">Akmax</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">Akmax</span><span class="p">,</span><span class="w"> </span><span class="n">aijmax</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">aijtol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aijmax</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Ltol</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Find a suitable pivot element.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Utri</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">          </span><span class="c">! So far all columns have had length 1.</span>
<span class="w">          </span><span class="c">! We are still looking for the (backward) triangular part of A</span>
<span class="w">          </span><span class="c">! that forms the first rows and columns of U.</span>
<span class="w">          </span><span class="c">! 12 Dec 2015: Use nslack and kslack to choose slacks first.</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">          </span><span class="n">lq1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">iqloc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">          </span><span class="n">lq2</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">lq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iqloc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">kslack</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nslack</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             do </span><span class="n">lq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lq1</span><span class="p">,</span><span class="w"> </span><span class="n">lq2</span>
<span class="w">                </span><span class="n">j</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">lq</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Accept a slack</span>
<span class="w">                   </span><span class="n">kslack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kslack</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                   </span><span class="n">jbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">j</span>
<span class="w">                   </span><span class="n">lc</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">                   </span><span class="n">ibest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">                   </span><span class="n">abest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">                   </span><span class="n">mbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                   </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">300</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">             end do</span>

<span class="w">             </span><span class="c">! DEBUG ERROR</span>
<span class="w">             </span><span class="c">! write(*,*) &#39;slack not found&#39;</span>
<span class="w">             </span><span class="c">! write(*,*) &#39;kslack, nslack =&#39;, kslack, nslack</span>
<span class="w">             </span><span class="c">! stop</span>

<span class="w">          </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">kslack</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nslack</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c">! Maybe print msg</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Slacks ended.  nslack =&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nslack</span>
<span class="w">             </span><span class="k">end if</span>
<span class="k">             </span><span class="n">kslack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nslack</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">          </span><span class="c">! So print happens once</span>
<span class="w">          </span><span class="k">end if</span>

<span class="w">          </span><span class="c">! All slacks will be grabbed before we get here.</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lq1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lq2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">  </span><span class="c">! There are more cols of length 1.</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TSP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">jbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">lq1</span><span class="p">)</span><span class="w">   </span><span class="c">! Grab the first one.</span>

<span class="w">             </span><span class="k">else</span><span class="w"> </span><span class="c">! TRP or TCP    ! Scan all columns of length 1.</span>
<span class="w">                </span><span class="n">jbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">                </span><span class="k">do </span><span class="n">lq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lq1</span><span class="p">,</span><span class="w"> </span><span class="n">lq2</span>
<span class="w">                   </span><span class="n">j</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="n">lq</span><span class="p">)</span>
<span class="w">                   </span><span class="c">! 12 Dec 2015: Slacks grabbed earlier.</span>
<span class="w">                   </span><span class="c">! if (w(j) &gt; zero) then ! Accept a slack</span>
<span class="w">                   </span><span class="c">!   jbest  = j</span>
<span class="w">                   </span><span class="c">!   go to 250</span>
<span class="w">                   </span><span class="c">! end if</span>

<span class="w">                   </span><span class="n">lc</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                   </span><span class="nb">amax</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TRP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                      </span><span class="n">i</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">                      </span><span class="n">aijtol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Amaxr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Ltol</span>
<span class="w">                   </span><span class="k">end if</span>

<span class="k">                   if</span><span class="w"> </span><span class="p">(</span><span class="nb">amax</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">aijtol</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                      </span><span class="n">jbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">j</span>
<span class="w">                      </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">250</span>
<span class="w">                   </span><span class="k">end if</span>
<span class="k">                end do</span>
<span class="k">             end if</span>

<span class="mi">250</span><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jbest</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">lc</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">                </span><span class="n">ibest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">                </span><span class="n">mbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">300</span>
<span class="w">             </span><span class="k">end if</span>
<span class="k">          end if</span>

<span class="w">          </span><span class="c">! This is the end of the U triangle.</span>
<span class="w">          </span><span class="c">! We will not return to this part of the code.</span>
<span class="w">          </span><span class="c">! TPP and TSP call lu1mxc for the first time</span>
<span class="w">          </span><span class="c">! (to move biggest element to top of each column).</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1100</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Utri ended.  spars1 = true&#39;</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">          </span><span class="n">Utri</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">          </span><span class="n">Ltri</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">          </span><span class="n">spars1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">          </span><span class="n">nUtri</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="n">nrowu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TSP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mxc</span><span class="p">(</span><span class="w"> </span><span class="n">lq1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">       end if</span>

<span class="k">       if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">spars1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">          </span><span class="c">! Perform a Markowitz search.</span>
<span class="w">          </span><span class="c">! Search cols of length 1, then rows of length 1,</span>
<span class="w">          </span><span class="c">! then   cols of length 2, then rows of length 2, etc.</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">          </span><span class="c">! if (TPP) then ! 12 Jun 2002: Next line disables lu1mCP below</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TCP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mar</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">TCP</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">aijtol</span><span class="p">,</span><span class="w"> </span><span class="n">Ltol</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="n">maxrow</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">lenc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w">  </span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">iploc</span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">)</span>

<span class="w">          </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">TRP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mRP</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">Ltol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="n">maxrow</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">lenc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">iploc</span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Amaxr</span><span class="w"> </span><span class="p">)</span>

<span class="w">             </span><span class="c">! else if (TCP) then ! Disabled by test above</span>
<span class="w">             </span><span class="c">! call lu1mCP( m    , n     , lena  , aijtol, &amp;</span>
<span class="w">             </span><span class="c">!              ibest, jbest , mbest ,         &amp;</span>
<span class="w">             </span><span class="c">!              a    , indc  , indr  ,         &amp;</span>
<span class="w">             </span><span class="c">!              lenc , lenr  , locc  ,         &amp;</span>
<span class="w">             </span><span class="c">!              Hlen , Ha    , Hj    )</span>

<span class="w">          </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">TSP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mSP</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">Ltol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">)</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ibest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">990</span>
<span class="w">          </span><span class="k">end if</span>

<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ltri</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">             </span><span class="c">! So far all rows have had length 1.</span>
<span class="w">             </span><span class="c">! We are still looking for the (forward) triangle of A</span>
<span class="w">             </span><span class="c">! that forms the first rows and columns of L.</span>

<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mbest</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">Ltri</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                </span><span class="n">nLtri</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="n">nrowu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nUtri</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                   write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1100</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Ltri ended.&#39;</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">             end if</span>

<span class="k">          else</span><span class="w">    </span><span class="c">! See if what&#39;s left is as dense as dens1.</span>

<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nzleft</span><span class="w">  </span><span class="o">&gt;=</span><span class="w">  </span><span class="p">(</span><span class="n">dens1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mleft</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nleft</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">spars1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                </span><span class="n">spars2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">                </span><span class="n">ndens1</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">nleft</span>
<span class="w">                </span><span class="n">maxrow</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">0</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                   write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1100</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;spars1 ended.  spars2 = true&#39;</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">             end if</span>
<span class="k">          end if</span>

<span class="k">       else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">spars2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dense</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">          </span><span class="c">! Perform a restricted Markowitz search,</span>
<span class="w">          </span><span class="c">! looking at only the first maxcol columns.  (maxrow = 0.)</span>
<span class="w">          </span><span class="c">!------------------------------------------------------------</span>
<span class="w">        </span><span class="c">! if (TPP) then ! 12 Jun 2002: Next line disables lu1mCP below</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TCP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mar</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">TCP</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">aijtol</span><span class="p">,</span><span class="w"> </span><span class="n">Ltol</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="n">maxrow</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">lenc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w">  </span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">iploc</span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">)</span>

<span class="w">          </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">TRP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mRP</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">Ltol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w"> </span><span class="n">maxrow</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">lenc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">iploc</span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Amaxr</span><span class="w"> </span><span class="p">)</span>

<span class="w">             </span><span class="c">! else if (TCP) then ! Disabled by test above</span>
<span class="w">             </span><span class="c">! call lu1mCP( m    , n     , lena  , aijtol, &amp;</span>
<span class="w">             </span><span class="c">!              ibest, jbest , mbest ,         &amp;</span>
<span class="w">             </span><span class="c">!              a    , indc  , indr  ,         &amp;</span>
<span class="w">             </span><span class="c">!              lenc , lenr  , locc  ,         &amp;</span>
<span class="w">             </span><span class="c">!              Hlen , Ha    , Hj    )</span>

<span class="w">          </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">TSP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mSP</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">maxmn</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">Ltol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxcol</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mbest</span><span class="w"> </span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="w"> </span><span class="p">)</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ibest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">985</span>
<span class="w">          </span><span class="k">end if</span>

<span class="w">          </span><span class="c">! See if what&#39;s left is as dense as dens2.</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">spars2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             if</span><span class="w"> </span><span class="p">(</span><span class="n">nzleft</span><span class="w">  </span><span class="o">&gt;=</span><span class="w">  </span><span class="p">(</span><span class="n">dens2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mleft</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nleft</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">spars2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                </span><span class="n">dense</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">                </span><span class="n">ndens2</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">nleft</span>
<span class="w">                </span><span class="n">maxcol</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">1</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                   write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1100</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;spars2 ended.  dense = true&#39;</span>
<span class="w">                </span><span class="k">end if</span>
<span class="k">             end if</span>
<span class="k">          end if</span>
<span class="k">       end if</span>

<span class="w">       </span><span class="c">!---------------------------------------------------------------</span>
<span class="w">       </span><span class="c">! See if we can finish quickly.</span>
<span class="w">       </span><span class="c">!---------------------------------------------------------------</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">dense</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">lenD</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">mleft</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nleft</span>
<span class="w">          </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">          </span><span class="c">! 28 Sep 2015: Change 2 to 3 for safety.</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lenD</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">             </span><span class="c">! There is room to treat the remaining matrix as</span>
<span class="w">             </span><span class="c">! a dense matrix D.</span>
<span class="w">             </span><span class="c">! We may have to compress the column file first.</span>
<span class="w">             </span><span class="c">! 12 Nov 1999: D used to be put at the</span>
<span class="w">             </span><span class="c">!              beginning of free storage (lD = lcol + 1).</span>
<span class="w">             </span><span class="c">!              Now put it at the end     (lD = lu1 - lenD)</span>
<span class="w">             </span><span class="c">!              so the left-shift in lu1ful will not</span>
<span class="w">             </span><span class="c">!              involve overlapping storage</span>
<span class="w">             </span><span class="c">!              (fatal with parallel dcopy).</span>

<span class="w">             </span><span class="n">densLU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">             </span><span class="n">ndens2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nleft</span>
<span class="w">             </span><span class="n">lD</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lenD</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lcol</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lD</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                call </span><span class="n">lu1rec</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">lcol</span><span class="p">,</span><span class="w"> </span><span class="n">jlast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                             </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">             </span><span class="k">end if</span>

<span class="k">             go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">900</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">       end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! The best aij has been found.</span>
<span class="w">       </span><span class="c">! The pivot row ibest and the pivot column jbest</span>
<span class="w">       </span><span class="c">! define a dense matrix D of size nrowd x ncold.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="mi">300</span><span class="w">    </span><span class="n">ncold</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lenr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span>
<span class="w">       </span><span class="n">nrowd</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lenc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">       </span><span class="n">melim</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nrowd</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">nelim</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ncold</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">mersum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mersum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mbest</span>
<span class="w">       </span><span class="n">lenL</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">lenL</span><span class="w">   </span><span class="o">+</span><span class="w"> </span><span class="n">melim</span>
<span class="w">       </span><span class="n">lenU</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">lenU</span><span class="w">   </span><span class="o">+</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">nrowu</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1100</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;lu1fad debug:&#39;</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">TPP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TRP</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">TSP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">)</span><span class="w"> </span><span class="n">nrowu</span><span class="p">,</span><span class="w"> </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="p">,</span><span class="w"> </span><span class="n">nrowd</span><span class="p">,</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="c">! TCP</span>
<span class="w">             </span><span class="n">jmax</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">Hj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">             </span><span class="n">imax</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">locc</span><span class="p">(</span><span class="n">jmax</span><span class="p">))</span>
<span class="w">             </span><span class="k">write</span><span class="p">(</span><span class="n">nout</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">)</span><span class="w"> </span><span class="n">nrowu</span><span class="p">,</span><span class="w"> </span><span class="n">ibest</span><span class="p">,</span><span class="w"> </span><span class="n">jbest</span><span class="p">,</span><span class="w"> </span><span class="n">nrowd</span><span class="p">,</span><span class="w"> </span><span class="n">ncold</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                               </span><span class="n">imax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aijmax</span>
<span class="w">          </span><span class="k">end if</span>
<span class="k">       end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Allocate storage for the next column of  L  and next row of  U.</span>
<span class="w">       </span><span class="c">! Initially the top of a, indc, indr are used as follows:</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">!            ncold       melim       ncold        melim</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! a      |...........|...........|ujbest..ujn|li1......lim|</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! indc   |...........|  lenr(i)  |  lenc(j)  |  markl(i)  |</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! indr   |...........| iqloc(i)  |  jfill(j) |  ifill(i)  |</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">!       ^           ^             ^           ^            ^</span>
<span class="w">       </span><span class="c">!       lfree   lsave             lu1         ll1          oldlu1</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! Later the correct indices are inserted:</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! indc   |           |           |           |i1........im|</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! indr   |           |           |jbest....jn|ibest..ibest|</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">keepLU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">! relax</span>
<span class="w">       </span><span class="k">else</span>
<span class="w">          </span><span class="c">! Always point to the top spot.</span>
<span class="w">          </span><span class="c">! Only the current column of L and row of U will</span>
<span class="w">          </span><span class="c">! take up space, overwriting the previous ones.</span>
<span class="w">          </span><span class="n">lu1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ldiagU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="k">end if</span>
<span class="k">       </span><span class="n">ll1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">melim</span>
<span class="w">       </span><span class="n">lu1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ll1</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">       </span><span class="n">lsave</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">nrowd</span>
<span class="w">       </span><span class="n">lfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lsave</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ncold</span>

<span class="w">       </span><span class="c">! Make sure the column file has room.</span>
<span class="w">       </span><span class="c">! Also force a compression if its length exceeds a certain limit.</span>

<span class="w">       </span><span class="n">limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">Uspace</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="n">lfile</span><span class="p">))</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="n">m</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="n">n</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="mi">1000</span>
<span class="w">       </span><span class="n">minfre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncold</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">melim</span>
<span class="w">       </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w">  </span><span class="n">lcol</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          call </span><span class="n">lu1rec</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">lcol</span><span class="p">,</span><span class="w"> </span><span class="n">jlast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">          </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">970</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">! Make sure the row file has room.</span>

<span class="w">       </span><span class="n">minfre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">melim</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">       </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w">  </span><span class="n">lrow</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          call </span><span class="n">lu1rec</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">lrow</span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">          </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">970</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Move the pivot element to the front of its row</span>
<span class="w">       </span><span class="c">! and to the top of its column.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="n">lpivr</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">locr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span>
<span class="w">       </span><span class="n">lpivr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">lpivr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nelim</span>

<span class="w">       </span><span class="k">do </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">indr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">jbest</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">       end do</span>

<span class="k">       </span><span class="n">indr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lpivr</span><span class="p">)</span>
<span class="w">       </span><span class="n">indr</span><span class="p">(</span><span class="n">lpivr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jbest</span>

<span class="w">       </span><span class="n">lpivc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">       </span><span class="n">lpivc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">lpivc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">melim</span>

<span class="w">       </span><span class="k">do </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">indc</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ibest</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">       end do</span>

<span class="k">       </span><span class="n">indc</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lpivc</span><span class="p">)</span>
<span class="w">       </span><span class="n">indc</span><span class="p">(</span><span class="n">lpivc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ibest</span>
<span class="w">       </span><span class="n">abest</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="w">       </span><span class="n">a</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lpivc</span><span class="p">)</span>
<span class="w">       </span><span class="n">a</span><span class="p">(</span><span class="n">lpivc</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">abest</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">keepLU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">! relax</span>
<span class="w">       </span><span class="k">else</span>
<span class="w">          </span><span class="c">! Store just the diagonal of U, in natural order.</span>
<span class="w">          </span><span class="c">!!!   a(ldiagU + nrowu) = abest ! This was in pivot order.</span>
<span class="w">          </span><span class="n">a</span><span class="p">(</span><span class="n">ldiagU</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jbest</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abest</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!==============================================================</span>
<span class="w">       </span><span class="c">! Delete pivot col from heap.</span>
<span class="w">       </span><span class="c">! Hk tells us where it is in the heap.</span>
<span class="w">       </span><span class="c">!==============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">TCP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">kbest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Hk</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">          </span><span class="n">Hlenin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hlen</span>
<span class="w">          </span><span class="k">call </span><span class="n">Hdelete</span><span class="p">(</span><span class="w"> </span><span class="n">Ha</span><span class="p">,</span><span class="w"> </span><span class="n">Hj</span><span class="p">,</span><span class="w"> </span><span class="n">Hk</span><span class="p">,</span><span class="w"> </span><span class="n">Hlenin</span><span class="p">,</span><span class="w"> </span><span class="n">Hlen</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">kbest</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">hops</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Delete the pivot row from the column file</span>
<span class="w">       </span><span class="c">! and store it as the next row of  U.</span>
<span class="w">       </span><span class="c">! Set indr(lu) = 0    to initialize jfill ptrs on columns of D,</span>
<span class="w">       </span><span class="c">!     indc(lu) = lenj to save the original column lengths.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="n">a</span><span class="p">(</span><span class="n">lu1</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">abest</span>
<span class="w">       </span><span class="n">indr</span><span class="p">(</span><span class="n">lu1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jbest</span>
<span class="w">       </span><span class="n">indc</span><span class="p">(</span><span class="n">lu1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrowd</span>
<span class="w">       </span><span class="n">lu</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span>

<span class="w">       </span><span class="n">diag</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">abest</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="n">Umax</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w">  </span><span class="n">Umax</span><span class="p">,</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="n">DUmax</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">DUmax</span><span class="p">,</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="n">DUmin</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">DUmin</span><span class="p">,</span><span class="w"> </span><span class="n">diag</span><span class="w"> </span><span class="p">)</span>

<span class="w">       </span><span class="k">do </span><span class="n">lr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span>
<span class="w">          </span><span class="n">lu</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">lu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">j</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span>
<span class="w">          </span><span class="n">lenj</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lenc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">          </span><span class="n">lenc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenj</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">lc1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">          </span><span class="n">last</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">lc1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lenc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

<span class="w">          </span><span class="k">do </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lc1</span><span class="p">,</span><span class="w"> </span><span class="n">last</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">indc</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ibest</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">          end do</span>

<span class="k">          </span><span class="n">a</span><span class="p">(</span><span class="n">lu</span><span class="p">)</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">lu</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">lu</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">lenj</span>
<span class="w">          </span><span class="n">Umax</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">Umax</span><span class="p">,</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lu</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">a</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">       </span><span class="c">! Free entry</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">jlast</span><span class="p">)</span><span class="w"> </span><span class="n">lcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lcol</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="k">end do</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Delete the pivot column from the row file</span>
<span class="w">       </span><span class="c">! and store the nonzeros of the next column of  L.</span>
<span class="w">       </span><span class="c">! Set  indc(ll) = 0      to initialize markl(*) markers,</span>
<span class="w">       </span><span class="c">! indr(ll) = 0           to initialize ifill(*) row fill-in cntrs,</span>
<span class="w">       </span><span class="c">! indc(ls) = leni        to save the original row lengths,</span>
<span class="w">       </span><span class="c">! indr(ls) = iqloc(i)    to save parts of  iqloc(*),</span>
<span class="w">       </span><span class="c">! iqloc(i) = lsave - ls  to point to the nonzeros of  L</span>
<span class="w">       </span><span class="c">!          = -1, -2, -3, ... in mark(*).</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="n">indc</span><span class="p">(</span><span class="n">lsave</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">melim</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">700</span>

<span class="w">       </span><span class="n">ll</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ll1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">ls</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">lsave</span>
<span class="w">       </span><span class="n">abest</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">abest</span>

<span class="w">       </span><span class="k">do </span><span class="n">lc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span>
<span class="w">          </span><span class="n">ll</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">ls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">i</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">          </span><span class="n">leni</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">lenr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">          </span><span class="n">lenr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">leni</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">lr1</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">locr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">          </span><span class="n">last</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">lr1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lenr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="w">          </span><span class="k">do </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lr1</span><span class="p">,</span><span class="w"> </span><span class="n">last</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">indr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">jbest</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<span class="k">          end do</span>

<span class="k">          </span><span class="n">indr</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">       </span><span class="c">! Free entry</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="n">lrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lrow</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">          </span><span class="n">a</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">abest</span>
<span class="w">          </span><span class="n">Lij</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">Lmax</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">Lmax</span><span class="p">,</span><span class="w"> </span><span class="n">Lij</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="c">!!!!! DEBUG</span>
<span class="w">          </span><span class="c">! if (Lij &gt; Ltol) then</span>
<span class="w">          </span><span class="c">! write( *  ,*) &#39; Big Lij!!!&#39;, nrowu</span>
<span class="w">          </span><span class="c">! write(nout,*) &#39; Big Lij!!!&#39;, nrowu</span>
<span class="w">          </span><span class="c">! end if</span>

<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">leni</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">iqloc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">          </span><span class="n">iqloc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">lsave</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ls</span>
<span class="w">       </span><span class="k">end do</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Do the Gaussian elimination.</span>
<span class="w">       </span><span class="c">! This involves adding a multiple of the pivot column</span>
<span class="w">       </span><span class="c">! to all other columns in the pivot row.</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! Sometimes more than one call to lu1gau is needed to allow</span>
<span class="w">       </span><span class="c">! compression of the column file.</span>
<span class="w">       </span><span class="c">! lfirst  says which column the elimination should start with.</span>
<span class="w">       </span><span class="c">! minfre  is a bound on the storage needed for any one column.</span>
<span class="w">       </span><span class="c">! lu      points to off-diagonals of u.</span>
<span class="w">       </span><span class="c">! nfill   keeps track of pending fill-in in the row file.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nelim</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">700</span>
<span class="w">       </span><span class="n">lfirst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr1</span>
<span class="w">       </span><span class="n">minfre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mleft</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nspare</span>
<span class="w">       </span><span class="n">lu</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">nfill</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="mi">400</span><span class="w">    </span><span class="k">call </span><span class="n">lu1gau</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">melim</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ncold</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nspare</span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">lpivc1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span><span class="p">,</span><span class="w"> </span><span class="n">lfirst</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span><span class="p">,</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">minfre</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">ilast</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jlast</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lrow</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lcol</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lu</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">nfill</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">a</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w">                         </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">lenc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w">  </span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">iqloc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ll1</span><span class="p">),</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">ll1</span><span class="p">),</span><span class="w">                      </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">a</span><span class="p">(</span><span class="n">lu1</span><span class="p">),</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">ll1</span><span class="p">),</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lu1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lfirst</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">          </span><span class="c">! The elimination was interrupted.</span>
<span class="w">          </span><span class="c">! Compress the column file and try again.</span>
<span class="w">          </span><span class="c">! lfirst, lu and nfill have appropriate new values.</span>

<span class="w">          </span><span class="k">call </span><span class="n">lu1rec</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">lcol</span><span class="p">,</span><span class="w"> </span><span class="n">jlast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>
<span class="w">          </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">          </span><span class="n">lpivc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">          </span><span class="n">lpivc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">lpivc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">melim</span>
<span class="w">          </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lcol</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">970</span>
<span class="w">          </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">400</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! The column file has been fully updated.</span>
<span class="w">       </span><span class="c">! Deal with any pending fill-in in the row file.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfill</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">          </span><span class="c">! Compress the row file if necessary.</span>
<span class="w">          </span><span class="c">! lu1gau has set nfill to be the number of pending fill-ins</span>
<span class="w">          </span><span class="c">! plus the current length of any rows that need to be moved.</span>

<span class="w">          </span><span class="n">minfre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfill</span>
<span class="w">          </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1rec</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="w"> </span><span class="n">luparm</span><span class="p">,</span><span class="w"> </span><span class="n">lrow</span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w"> </span><span class="p">)</span>
<span class="w">             </span><span class="n">lfile</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">             </span><span class="n">lpivr</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">locr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span>
<span class="w">             </span><span class="n">lpivr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">             </span><span class="n">lpivr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nelim</span>
<span class="w">             </span><span class="n">nfree</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lfree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lrow</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nfree</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minfre</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">970</span>
<span class="w">          </span><span class="k">end if</span>

<span class="w">          </span><span class="c">! Move rows that have pending fill-in to end of the row file.</span>
<span class="w">          </span><span class="c">! Then insert the fill-in.</span>

<span class="w">          </span><span class="k">call </span><span class="n">lu1pen</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">melim</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ncold</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nspare</span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">lpivc1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span><span class="p">,</span><span class="w"> </span><span class="n">lrow</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">lenc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w">  </span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">indc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">ll1</span><span class="p">),</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lu1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="k">end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Restore the saved values of iqloc.</span>
<span class="w">       </span><span class="c">! Insert the correct indices for the col of L and the row of U.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="mi">700</span><span class="w">    </span><span class="n">lenr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">       </span><span class="n">lenc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">       </span><span class="n">ll</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">ll1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">       </span><span class="n">ls</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">lsave</span>

<span class="w">       </span><span class="k">do </span><span class="n">lc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lpivc1</span><span class="p">,</span><span class="w"> </span><span class="n">lpivc2</span>
<span class="w">          </span><span class="n">ll</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">ls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">i</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
<span class="w">          </span><span class="n">iqloc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
<span class="w">          </span><span class="n">indc</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ibest</span>
<span class="w">       </span><span class="k">end do</span>

<span class="k">       </span><span class="n">lu</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>

<span class="w">       </span><span class="k">do </span><span class="n">lr</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">lpivr</span><span class="p">,</span><span class="w"> </span><span class="n">lpivr2</span>
<span class="w">          </span><span class="n">lu</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">lu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="n">indr</span><span class="p">(</span><span class="n">lu</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span>
<span class="w">       </span><span class="k">end do</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Free the space occupied by the pivot row</span>
<span class="w">       </span><span class="c">! and update the column permutation.</span>
<span class="w">       </span><span class="c">! Then free the space occupied by the pivot column</span>
<span class="w">       </span><span class="c">! and update the row permutation.</span>
<span class="w">       </span><span class="c">!</span>
<span class="w">       </span><span class="c">! nzchng is found in both calls to lu1pq2, but we use it only</span>
<span class="w">       </span><span class="c">! after the second.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">call </span><span class="n">lu1pq2</span><span class="p">(</span><span class="w"> </span><span class="n">ncold</span><span class="p">,</span><span class="w"> </span><span class="n">nzchng</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">indr</span><span class="p">(</span><span class="n">lpivr</span><span class="p">),</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="w"> </span><span class="n">lu1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">iqloc</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">iqinv</span><span class="w"> </span><span class="p">)</span>

<span class="w">       </span><span class="k">call </span><span class="n">lu1pq2</span><span class="p">(</span><span class="w"> </span><span class="n">nrowd</span><span class="p">,</span><span class="w"> </span><span class="n">nzchng</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">indc</span><span class="p">(</span><span class="n">lpivc</span><span class="p">),</span><span class="w"> </span><span class="n">indc</span><span class="p">(</span><span class="n">lsave</span><span class="p">),</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">iploc</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">ipinv</span><span class="w"> </span><span class="p">)</span>

<span class="w">       </span><span class="n">nzleft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nzleft</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nzchng</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! lu1mxr resets Amaxr(i) in each modified row i.</span>
<span class="w">       </span><span class="c">! lu1mxc moves the largest aij to the top of each modified col j.</span>
<span class="w">       </span><span class="c">! 28 Jun 2002: Note that cols of L have an implicit diag of 1.0,</span>
<span class="w">       </span><span class="c">!              so lu1mxr is called with ll1, not ll1+1, whereas</span>
<span class="w">       </span><span class="c">!              lu1mxc is called with             lu1+1.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Utri</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">TPP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">          </span><span class="c">! Relax -- we&#39;re not keeping big elements at the top yet.</span>

<span class="w">       </span><span class="k">else</span>
<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">TRP</span><span class="w">  </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w">  </span><span class="n">melim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">             </span><span class="c">! Beware: The parts of p that we need are in indc(ll1:ll)</span>
<span class="w">             </span><span class="c">! 28 Sep 2015: inform is now an output.</span>

<span class="w">             </span><span class="n">mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mark</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">             </span><span class="k">call </span><span class="n">lu1mxr</span><span class="p">(</span><span class="w"> </span><span class="n">mark</span><span class="p">,</span><span class="w"> </span><span class="n">ll1</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="p">,</span><span class="w"> </span><span class="n">inform</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                          </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">markc</span><span class="p">,</span><span class="w"> </span><span class="n">markr</span><span class="p">,</span><span class="w"> </span><span class="n">Amaxr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                        </span><span class="c">! ^^^^  Here are the p(k1:k2) needed by lu1mxr.</span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inform</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">981</span>
<span class="w">          </span><span class="k">end if</span>

<span class="k">          if</span><span class="w"> </span><span class="p">(</span><span class="n">nelim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">             call </span><span class="n">lu1mxc</span><span class="p">(</span><span class="w"> </span><span class="n">lu1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">lu</span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">indc</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">)</span>

<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TCP</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Update modified columns in heap</span>
<span class="w">                </span><span class="c">! 20 Dec 2015: Allow for empty columns.</span>
<span class="w">                </span><span class="k">do </span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lu1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">lu</span>
<span class="w">                   </span><span class="n">j</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">indr</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
<span class="w">                   </span><span class="n">k</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Hk</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lenc</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                      </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">locc</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c">! Biggest aij in column j</span>
<span class="w">                   </span><span class="k">else</span>
<span class="k">                      </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                   </span><span class="k">end if</span>
<span class="k">                   call </span><span class="n">Hchange</span><span class="p">(</span><span class="w"> </span><span class="n">Ha</span><span class="p">,</span><span class="w"> </span><span class="n">Hj</span><span class="p">,</span><span class="w"> </span><span class="n">Hk</span><span class="p">,</span><span class="w"> </span><span class="n">Hlen</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">)</span>
<span class="w">                   </span><span class="n">hops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">             end if</span>
<span class="k">          end if</span>
<span class="k">       end if</span>

<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="c">! Negate lengths of pivot row and column so they will be</span>
<span class="w">       </span><span class="c">! eliminated during compressions.</span>
<span class="w">       </span><span class="c">!===============================================================</span>
<span class="w">       </span><span class="n">lenr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ncold</span>
<span class="w">       </span><span class="n">lenc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nrowd</span>

<span class="w">       </span><span class="c">! Test for fatal bug: row or column lists overwriting L and U.</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lrow</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lsave</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">980</span>
<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lcol</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lsave</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">980</span>

<span class="w">       </span><span class="c">! Reset the file lengths if pivot row or col was at the end.</span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ibest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">lrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locr</span><span class="p">(</span><span class="n">ibest</span><span class="p">)</span>
<span class="w">       </span><span class="k">end if</span>

<span class="k">       if</span><span class="w"> </span><span class="p">(</span><span class="n">jbest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">jlast</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">          </span><span class="n">lcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locc</span><span class="p">(</span><span class="n">jbest</span><span class="p">)</span>
<span class="w">       </span><span class="k">end if</span>
<span class="mi">800</span><span class="w"> </span><span class="k">end do</span>

<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! End of main loop.</span>
<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>

<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="w">    </span><span class="c">! Normal exit.</span>
<span class="w">    </span><span class="c">! Move empty rows and cols to the end of p, q.</span>
<span class="w">    </span><span class="c">! Then finish with a dense LU if necessary.</span>
<span class="w">    </span><span class="c">!------------------------------------------------------------------</span>
<span class="mi">900</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">call </span><span class="n">lu1pq3</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">ipinv</span><span class="p">,</span><span class="w"> </span><span class="n">mrank</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">call </span><span class="n">lu1pq3</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">lenc</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">iqinv</span><span class="p">,</span><span class="w"> </span><span class="n">nrank</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">nrank</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">mrank</span><span class="p">,</span><span class="w"> </span><span class="n">nrank</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">densLU</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">       call </span><span class="n">lu1ful</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lena</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lenD</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lu1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">TPP</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">mleft</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nleft</span><span class="p">,</span><span class="w"> </span><span class="n">nrank</span><span class="p">,</span><span class="w"> </span><span class="n">nrowu</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">lenL</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenU</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nsing</span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">keepLU</span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="p">,</span><span class="w">                          </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">a</span><span class="w">     </span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lD</span><span class="p">),</span><span class="w"> </span><span class="n">indc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span>
<span class="w">                    </span><span class="n">lenc</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lenr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">locc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ipinv</span><span class="p">,</span><span class="w"> </span><span class="n">locr</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="c">!***     21 Dec 1994: Bug in next line.</span>
<span class="w">       </span><span class="c">!***     nrank  = nrank - nsing.  Changed to next line:</span>
<span class="w">       </span><span class="c">!***     nrank  = minmn - nsing</span>

<span class="w">       </span><span class="c">!***     26 Mar 2006: Previous line caused bug with m&lt;n and nsing&gt;0.</span>
<span class="w">       </span><span class="c">! Don&#39;t mess with nrank any more.  Let end of lu1fac handle it.</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    </span><span class="n">minlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lenL</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="n">lenU</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">990</span>

<span class="w">    </span><span class="c">! Not enough space free after a compress.</span>
<span class="w">    </span><span class="c">! Set  minlen  to an estimate of the necessary value of  lena.</span>

<span class="mi">970</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="w">    </span><span class="n">minlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lena</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="n">lfile</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">990</span>

<span class="w">    </span><span class="c">! Fatal error.  This will never happen!</span>
<span class="w">    </span><span class="c">! (Famous last words.)</span>

<span class="mi">980</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">990</span>

<span class="w">    </span><span class="c">! Fatal error in lu1mxr.  This will never happen!</span>

<span class="mi">981</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">990</span>

<span class="w">    </span><span class="c">! Fatal error with TSP.  Diagonal pivot not found.</span>

<span class="mi">985</span><span class="w"> </span><span class="n">inform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span>

<span class="w">    </span><span class="c">! Exit.</span>

<span class="mi">990</span><span class="w"> </span><span class="k">return</span>

<span class="mi">1100</span><span class="w"> </span><span class="k">format</span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="mi">1200</span><span class="w"> </span><span class="k">format</span><span class="p">(</span><span class="s1">&#39; nrowu&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i7</span><span class="p">,</span><span class="w">     </span><span class="s1">&#39;   i,jbest&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">i7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;   nrowd,ncold&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">i6</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">            </span><span class="s1">&#39;   i,jmax&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">i7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;   aijmax&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">es10</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span>

<span class="w">  </span><span class="k">end subroutine </span><span class="n">lu1fad</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col"><p>AoC-2023 was developed by Jacob Williams<br>&copy; 2023 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>